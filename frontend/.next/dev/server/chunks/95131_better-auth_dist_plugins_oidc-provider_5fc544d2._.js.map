{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/dist/plugins/oidc-provider/error.mjs","sources":["file:///C:/Users/km/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/src/plugins/oidc-provider/error.ts"],"sourcesContent":["import { APIError } from \"better-call\";\n\nclass OIDCProviderError extends APIError {}\n\nexport class InvalidRequest extends OIDCProviderError {\n\tconstructor(error_description: string, error_detail?: string) {\n\t\tsuper(\"BAD_REQUEST\", {\n\t\t\tmessage: \"invalid_request\",\n\t\t\terror_description,\n\t\t\terror_detail,\n\t\t});\n\t}\n}\n"],"names":[],"mappings":";;;;;;;;AAEA,IAAM,oBAAN,cAAgC,4NAAA,CAAS;AAAA;AAEzC,IAAa,iBAAb,cAAoC,kBAAkB;IACrD,YAAY,iBAAA,EAA2B,YAAA,CAAuB;QAC7D,KAAA,CAAM,eAAe;YACpB,SAAS;YACT;YACA;SACA,CAAC"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/dist/plugins/oidc-provider/utils/prompt.mjs","sources":["file:///C:/Users/km/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/src/plugins/oidc-provider/utils/prompt.ts"],"sourcesContent":["import { InvalidRequest } from \"../error\";\n\nexport type AuthorizePrompt = \"login\" | \"consent\" | \"select_account\" | \"none\";\nexport type AuthorizePromptSet = ReadonlySet<AuthorizePrompt>;\n\n/**\n * Parse space-separated prompt string into a set of prompts\n *\n * @param prompt\n */\nexport function parsePrompt(prompt: string) {\n\tconst prompts = prompt.split(\" \").map((p) => p.trim());\n\tconst set = new Set<AuthorizePrompt>();\n\tfor (const p of prompts) {\n\t\tif (\n\t\t\tp === \"login\" ||\n\t\t\tp === \"consent\" ||\n\t\t\tp === \"select_account\" ||\n\t\t\tp === \"none\"\n\t\t) {\n\t\t\tset.add(p);\n\t\t}\n\t}\n\n\tif (set.has(\"none\") && set.size > 1) {\n\t\tthrow new InvalidRequest(\"prompt none must only be used alone\");\n\t}\n\n\treturn new Set(set) as AuthorizePromptSet;\n}\n"],"names":[],"mappings":";;;;;;;;;;;GAUA,SAAgB,YAAY,MAAA,EAAgB;IAC3C,MAAM,UAAU,OAAO,KAAA,CAAM,IAAI,CAAC,GAAA,CAAA,CAAK,IAAM,EAAE,IAAA,EAAM,CAAC;IACtD,MAAM,MAAA,aAAA,GAAM,IAAI,KAAsB;IACtC,KAAK,MAAM,KAAK,QACf,IACC,MAAM,WACN,MAAM,aACN,MAAM,oBACN,MAAM,OAEN,CAAA,IAAI,GAAA,CAAI,EAAE;IAIZ,IAAI,IAAI,GAAA,CAAI,OAAO,IAAI,IAAI,IAAA,GAAO,EACjC,CAAA,MAAM,IAAI,iQAAA,CAAe,sCAAsC;IAGhE,OAAO,IAAI,IAAI,IAAI"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/dist/plugins/oidc-provider/authorize.mjs","sources":["file:///C:/Users/km/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/src/plugins/oidc-provider/authorize.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { APIError } from \"better-call\";\nimport { getSessionFromCtx } from \"../../api\";\nimport { generateRandomString } from \"../../crypto\";\nimport { getClient } from \"./index\";\nimport type { AuthorizationQuery, OIDCOptions } from \"./types\";\nimport { parsePrompt } from \"./utils/prompt\";\n\nfunction formatErrorURL(url: string, error: string, description: string) {\n\treturn `${\n\t\turl.includes(\"?\") ? \"&\" : \"?\"\n\t}error=${error}&error_description=${description}`;\n}\n\nfunction getErrorURL(\n\tctx: GenericEndpointContext,\n\terror: string,\n\tdescription: string,\n) {\n\tconst baseURL =\n\t\tctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n\tconst formattedURL = formatErrorURL(baseURL, error, description);\n\treturn formattedURL;\n}\n\nexport async function authorize(\n\tctx: GenericEndpointContext,\n\toptions: OIDCOptions,\n) {\n\tconst handleRedirect = (url: string) => {\n\t\tconst fromFetch = ctx.request?.headers.get(\"sec-fetch-mode\") === \"cors\";\n\t\tif (fromFetch) {\n\t\t\treturn ctx.json({\n\t\t\t\tredirect: true,\n\t\t\t\turl,\n\t\t\t});\n\t\t} else {\n\t\t\tthrow ctx.redirect(url);\n\t\t}\n\t};\n\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...(options?.scopes || []),\n\t\t],\n\t};\n\tif (!ctx.request) {\n\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\terror_description: \"request not found\",\n\t\t\terror: \"invalid_request\",\n\t\t});\n\t}\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\t// Handle prompt=none per OIDC spec - must return error instead of redirecting\n\t\tconst query = ctx.query as AuthorizationQuery;\n\t\tconst promptSet = parsePrompt(query.prompt ?? \"\");\n\t\tif (promptSet.has(\"none\") && query.redirect_uri) {\n\t\t\treturn handleRedirect(\n\t\t\t\tformatErrorURL(\n\t\t\t\t\tquery.redirect_uri,\n\t\t\t\t\t\"login_required\",\n\t\t\t\t\t\"Authentication required but prompt is none\",\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * If the user is not logged in, we need to redirect them to the\n\t\t * login page.\n\t\t */\n\t\tawait ctx.setSignedCookie(\n\t\t\t\"oidc_login_prompt\",\n\t\t\tJSON.stringify(ctx.query),\n\t\t\tctx.context.secret,\n\t\t\t{\n\t\t\t\tmaxAge: 600,\n\t\t\t\tpath: \"/\",\n\t\t\t\tsameSite: \"lax\",\n\t\t\t},\n\t\t);\n\t\tconst queryFromURL = ctx.request.url?.split(\"?\")[1]!;\n\t\treturn handleRedirect(`${options.loginPage}?${queryFromURL}`);\n\t}\n\n\tconst query = ctx.query as AuthorizationQuery;\n\tif (!query.client_id) {\n\t\tconst errorURL = getErrorURL(\n\t\t\tctx,\n\t\t\t\"invalid_client\",\n\t\t\t\"client_id is required\",\n\t\t);\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\n\tif (!query.response_type) {\n\t\tconst errorURL = getErrorURL(\n\t\t\tctx,\n\t\t\t\"invalid_request\",\n\t\t\t\"response_type is required\",\n\t\t);\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\n\tconst client = await getClient(\n\t\tctx.query.client_id,\n\t\toptions.trustedClients || [],\n\t);\n\tif (!client) {\n\t\tconst errorURL = getErrorURL(\n\t\t\tctx,\n\t\t\t\"invalid_client\",\n\t\t\t\"client_id is required\",\n\t\t);\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tconst redirectURI = client.redirectUrls.find(\n\t\t(url) => url === ctx.query.redirect_uri,\n\t);\n\n\tif (!redirectURI || !query.redirect_uri) {\n\t\t/**\n\t\t * show UI error here warning the user that the redirect URI is invalid\n\t\t */\n\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: \"Invalid redirect URI\",\n\t\t});\n\t}\n\tif (client.disabled) {\n\t\tconst errorURL = getErrorURL(ctx, \"client_disabled\", \"client is disabled\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\n\tif (query.response_type !== \"code\") {\n\t\tconst errorURL = getErrorURL(\n\t\t\tctx,\n\t\t\t\"unsupported_response_type\",\n\t\t\t\"unsupported response type\",\n\t\t);\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\n\tconst requestScope =\n\t\tquery.scope?.split(\" \").filter((s) => s) ||\n\t\topts.defaultScope?.split(\" \") ||\n\t\t[];\n\tconst invalidScopes = requestScope.filter((scope) => {\n\t\treturn !opts.scopes.includes(scope);\n\t});\n\tif (invalidScopes.length) {\n\t\treturn handleRedirect(\n\t\t\tformatErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"invalid_scope\",\n\t\t\t\t`The following scopes are invalid: ${invalidScopes.join(\", \")}`,\n\t\t\t),\n\t\t);\n\t}\n\n\tif (\n\t\t(!query.code_challenge || !query.code_challenge_method) &&\n\t\toptions.requirePKCE\n\t) {\n\t\treturn handleRedirect(\n\t\t\tformatErrorURL(query.redirect_uri, \"invalid_request\", \"pkce is required\"),\n\t\t);\n\t}\n\n\tif (!query.code_challenge_method) {\n\t\tquery.code_challenge_method = \"plain\";\n\t}\n\n\tif (\n\t\t![\n\t\t\t\"s256\",\n\t\t\toptions.allowPlainCodeChallengeMethod ? \"plain\" : \"s256\",\n\t\t].includes(query.code_challenge_method?.toLowerCase() || \"\")\n\t) {\n\t\treturn handleRedirect(\n\t\t\tformatErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"invalid_request\",\n\t\t\t\t\"invalid code_challenge method\",\n\t\t\t),\n\t\t);\n\t}\n\n\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\tconst codeExpiresInMs = opts.codeExpiresIn! * 1000;\n\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\n\t// Determine if consent is required\n\t// Consent is ALWAYS required unless:\n\t// 1. The client is trusted (skipConsent = true)\n\t// 2. The user has already consented and prompt is not \"consent\"\n\tconst skipConsentForTrustedClient = client.skipConsent;\n\tconst hasAlreadyConsented = await ctx.context.adapter\n\t\t.findOne<{\n\t\t\tconsentGiven: boolean;\n\t\t\tscopes: string;\n\t\t}>({\n\t\t\tmodel: \"oauthConsent\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tvalue: client.clientId,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: session.user.id,\n\t\t\t\t},\n\t\t\t],\n\t\t})\n\t\t.then((res) => {\n\t\t\tif (!res?.consentGiven) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst consentedScopes = res.scopes ? res.scopes.split(\" \") : [];\n\t\t\tconst hasConsented = requestScope.every((scope) =>\n\t\t\t\tconsentedScopes.includes(scope),\n\t\t\t);\n\t\t\treturn hasConsented;\n\t\t});\n\n\tconst promptSet = parsePrompt(query.prompt ?? \"\");\n\n\t// Handle prompt=none per OIDC spec 3.1.2.1\n\t// The Authorization Server MUST NOT display any authentication or consent UI\n\tif (promptSet.has(\"none\")) {\n\t\t// If consent is required, return consent_required error\n\t\tif (!skipConsentForTrustedClient && !hasAlreadyConsented) {\n\t\t\treturn handleRedirect(\n\t\t\t\tformatErrorURL(\n\t\t\t\t\tquery.redirect_uri,\n\t\t\t\t\t\"consent_required\",\n\t\t\t\t\t\"Consent required but prompt is none\",\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t\t// If we reach here, user is authenticated and consent is satisfied\n\t\t// Continue without any UI interaction\n\t}\n\n\t// Handle max_age parameter per OIDC spec 3.1.2.1\n\t// max_age=0 is equivalent to prompt=login\n\tlet requireLogin = promptSet.has(\"login\");\n\tif (query.max_age !== undefined) {\n\t\tconst maxAge = Number(query.max_age);\n\t\tif (Number.isInteger(maxAge) && maxAge >= 0) {\n\t\t\tconst sessionAge =\n\t\t\t\t(Date.now() - new Date(session.session.createdAt).getTime()) / 1000;\n\t\t\tif (sessionAge > maxAge) {\n\t\t\t\t// Session is older than max_age, force re-authentication\n\t\t\t\trequireLogin = true;\n\t\t\t}\n\t\t}\n\t\t// If max_age is invalid (not a non-negative integer), ignore it per OIDC spec\n\t}\n\n\tconst requireConsent =\n\t\t!skipConsentForTrustedClient &&\n\t\t(!hasAlreadyConsented || promptSet.has(\"consent\"));\n\n\ttry {\n\t\t/**\n\t\t * Save the code in the database\n\t\t */\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: JSON.stringify({\n\t\t\t\tclientId: client.clientId,\n\t\t\t\tredirectURI: query.redirect_uri,\n\t\t\t\tscope: requestScope,\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tauthTime: new Date(session.session.createdAt).getTime(),\n\t\t\t\t/**\n\t\t\t\t * Consent is required per OIDC spec unless:\n\t\t\t\t * 1. Client is trusted (skipConsent = true)\n\t\t\t\t * 2. User has already consented (and prompt is not \"consent\")\n\t\t\t\t *\n\t\t\t\t * When consent is required, the code needs to be treated as a\n\t\t\t\t * consent request. Once the user consents, the code will be\n\t\t\t\t * updated with the actual authorization code.\n\t\t\t\t */\n\t\t\t\trequireConsent,\n\t\t\t\tstate: requireConsent ? query.state : null,\n\t\t\t\tcodeChallenge: query.code_challenge,\n\t\t\t\tcodeChallengeMethod: query.code_challenge_method,\n\t\t\t\tnonce: query.nonce,\n\t\t\t}),\n\t\t\tidentifier: code,\n\t\t\texpiresAt,\n\t\t});\n\t} catch {\n\t\treturn handleRedirect(\n\t\t\tformatErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"server_error\",\n\t\t\t\t\"An error occurred while processing the request\",\n\t\t\t),\n\t\t);\n\t}\n\n\tif (requireLogin) {\n\t\tawait ctx.setSignedCookie(\n\t\t\t\"oidc_login_prompt\",\n\t\t\tJSON.stringify(ctx.query),\n\t\t\tctx.context.secret,\n\t\t\t{\n\t\t\t\tmaxAge: 600,\n\t\t\t\tpath: \"/\",\n\t\t\t\tsameSite: \"lax\",\n\t\t\t},\n\t\t);\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\",\n\t\t});\n\n\t\tconst loginURI = `${options.loginPage}?${new URLSearchParams({\n\t\t\tclient_id: client.clientId,\n\t\t\tcode,\n\t\t\tstate: query.state,\n\t\t}).toString()}`;\n\t\treturn handleRedirect(loginURI);\n\t}\n\n\t// If consent is not required, redirect with the code immediately\n\tif (!requireConsent) {\n\t\tconst redirectURIWithCode = new URL(redirectURI);\n\t\tredirectURIWithCode.searchParams.set(\"code\", code);\n\t\tredirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n\t\treturn handleRedirect(redirectURIWithCode.toString());\n\t}\n\n\t// Consent is required - redirect to consent page or show consent HTML\n\n\tif (options?.consentPage) {\n\t\t// Set cookie to support cookie-based consent flows\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\",\n\t\t});\n\n\t\t// Pass the consent code as a URL parameter to support URL-based consent flows\n\t\tconst urlParams = new URLSearchParams();\n\t\turlParams.set(\"consent_code\", code);\n\t\turlParams.set(\"client_id\", client.clientId);\n\t\turlParams.set(\"scope\", requestScope.join(\" \"));\n\t\tconst consentURI = `${options.consentPage}?${urlParams.toString()}`;\n\n\t\treturn handleRedirect(consentURI);\n\t}\n\tconst htmlFn = options?.getConsentHTML;\n\n\tif (!htmlFn) {\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\tmessage: \"No consent page provided\",\n\t\t});\n\t}\n\n\treturn new Response(\n\t\thtmlFn({\n\t\t\tscopes: requestScope,\n\t\t\tclientMetadata: client.metadata,\n\t\t\tclientIcon: client?.icon,\n\t\t\tclientId: client.clientId,\n\t\t\tclientName: client.name,\n\t\t\tcode,\n\t\t}),\n\t\t{\n\t\t\theaders: {\n\t\t\t\t\"content-type\": \"text/html\",\n\t\t\t},\n\t\t},\n\t);\n}\n"],"names":["query"],"mappings":"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"}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/dist/plugins/oidc-provider/schema.mjs","sources":["file:///C:/Users/km/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/src/plugins/oidc-provider/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\nimport * as z from \"zod\";\n\nconst oAuthApplicationSchema = z.object({\n\t/**\n\t * Client ID\n\t *\n\t * size 32\n\t *\n\t * as described on https://www.rfc-editor.org/rfc/rfc6749.html#section-2.2\n\t */\n\tclientId: z.string(),\n\t/**\n\t * Client Secret\n\t *\n\t * A secret for the client, if required by the authorization server.\n\t * Optional for public clients using PKCE.\n\t *\n\t * size 32\n\t */\n\tclientSecret: z.string().optional(),\n\t/**\n\t * The client type\n\t *\n\t * as described on https://www.rfc-editor.org/rfc/rfc6749.html#section-2.1\n\t *\n\t * - web - A web application\n\t * - native - A mobile application\n\t * - user-agent-based - A user-agent-based application\n\t * - public - A public client (PKCE-enabled, no client_secret)\n\t */\n\ttype: z.enum([\"web\", \"native\", \"user-agent-based\", \"public\"]),\n\t/**\n\t * The name of the client.\n\t */\n\tname: z.string(),\n\t/**\n\t * The icon of the client.\n\t */\n\ticon: z.string().optional(),\n\t/**\n\t * Additional metadata about the client.\n\t */\n\tmetadata: z.string().optional(),\n\t/**\n\t * Whether the client is disabled or not.\n\t */\n\tdisabled: z.boolean().optional().default(false),\n\n\t// Database fields\n\tredirectUrls: z.string(),\n\tuserId: z.string().optional(),\n\tcreatedAt: z.date(),\n\tupdatedAt: z.date(),\n});\n\nexport type OAuthApplication = z.infer<typeof oAuthApplicationSchema>;\n\nexport const schema = {\n\toauthApplication: {\n\t\tmodelName: \"oauthApplication\",\n\t\tfields: {\n\t\t\tname: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\ticon: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tmetadata: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true,\n\t\t\t},\n\t\t\tclientSecret: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tredirectUrls: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\ttype: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trequired: false,\n\t\t\t\tdefaultValue: false,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tupdatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t},\n\t},\n\toauthAccessToken: {\n\t\tmodelName: \"oauthAccessToken\",\n\t\tfields: {\n\t\t\taccessToken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true,\n\t\t\t},\n\t\t\trefreshToken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true,\n\t\t\t},\n\t\t\taccessTokenExpiresAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\trefreshTokenExpiresAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"oauthApplication\",\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tscopes: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tupdatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t},\n\t},\n\toauthConsent: {\n\t\tmodelName: \"oauthConsent\",\n\t\tfields: {\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"oauthApplication\",\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tscopes: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tupdatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tconsentGiven: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n"],"names":[],"mappings":";;;;;;;AAG+B,EAAE,uNAAA,CAAO;IAQvC,UAAU,EAAE,uNAAA,EAAQ;IASpB,cAAc,EAAE,uNAAA,EAAQ,CAAC,QAAA,EAAU;IAWnC,MAAM,EAAE,qNAAA,CAAK;QAAC;QAAO;QAAU;QAAoB;KAAS,CAAC;IAI7D,MAAM,EAAE,uNAAA,EAAQ;IAIhB,MAAM,EAAE,uNAAA,EAAQ,CAAC,QAAA,EAAU;IAI3B,UAAU,EAAE,uNAAA,EAAQ,CAAC,QAAA,EAAU;IAI/B,UAAU,EAAE,wNAAA,EAAS,CAAC,QAAA,EAAU,CAAC,OAAA,CAAQ,MAAM;IAG/C,cAAc,EAAE,uNAAA,EAAQ;IACxB,QAAQ,EAAE,uNAAA,EAAQ,CAAC,QAAA,EAAU;IAC7B,WAAW,EAAE,qNAAA,EAAM;IACnB,WAAW,EAAE,qNAAA,EAAM;CACnB,CAAC;AAIF,MAAa,SAAS;IACrB,kBAAkB;QACjB,WAAW;QACX,QAAQ;YACP,MAAM;gBACL,MAAM;YAAA,CACN;YACD,MAAM;gBACL,MAAM;gBACN,UAAU;aACV;YACD,UAAU;gBACT,MAAM;gBACN,UAAU;aACV;YACD,UAAU;gBACT,MAAM;gBACN,QAAQ;aACR;YACD,cAAc;gBACb,MAAM;gBACN,UAAU;aACV;YACD,cAAc;gBACb,MAAM;YAAA,CACN;YACD,MAAM;gBACL,MAAM;YAAA,CACN;YACD,UAAU;gBACT,MAAM;gBACN,UAAU;gBACV,cAAc;aACd;YACD,QAAQ;gBACP,MAAM;gBACN,UAAU;gBACV,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,WAAW;gBACV,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;SACD;KACD;IACD,kBAAkB;QACjB,WAAW;QACX,QAAQ;YACP,aAAa;gBACZ,MAAM;gBACN,QAAQ;aACR;YACD,cAAc;gBACb,MAAM;gBACN,QAAQ;aACR;YACD,sBAAsB;gBACrB,MAAM;YAAA,CACN;YACD,uBAAuB;gBACtB,MAAM;YAAA,CACN;YACD,UAAU;gBACT,MAAM;gBACN,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;gBACN,UAAU;gBACV,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;SACD;KACD;IACD,cAAc;QACb,WAAW;QACX,QAAQ;YACP,UAAU;gBACT,MAAM;gBACN,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;gBACN,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;YACD,cAAc;gBACb,MAAM;YAAA,CACN;SACD;KACD;CACD"}},
    {"offset": {"line": 436, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/dist/plugins/oidc-provider/utils.mjs","sources":["file:///C:/Users/km/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/src/plugins/oidc-provider/utils.ts"],"sourcesContent":["import { base64Url } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\n\n/**\n * Default client secret hasher using SHA-256\n */\nexport const defaultClientSecretHasher = async (clientSecret: string) => {\n\tconst hash = await createHash(\"SHA-256\").digest(\n\t\tnew TextEncoder().encode(clientSecret),\n\t);\n\tconst hashed = base64Url.encode(new Uint8Array(hash), {\n\t\tpadding: false,\n\t});\n\treturn hashed;\n};\n"],"names":[],"mappings":";;;;;;;;;;;GAMA,MAAa,4BAA4B,OAAO,iBAAyB;IACxE,MAAM,OAAO,UAAM,wOAAA,EAAW,UAAU,CAAC,MAAA,CACxC,IAAI,aAAa,CAAC,MAAA,CAAO,aAAa,CACtC;IAID,OAHe,yOAAA,CAAU,MAAA,CAAO,IAAI,WAAW,KAAK,EAAE;QACrD,SAAS;IAAA,CACT,CAAC"}},
    {"offset": {"line": 459, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/dist/plugins/oidc-provider/index.mjs","sources":["file:///C:/Users/km/Desktop/docs/hackatho-2/phase-2/frontend/node_modules/better-auth/src/plugins/oidc-provider/index.ts"],"sourcesContent":["import type {\n\tBetterAuthPlugin,\n\tGenericEndpointContext,\n} from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { base64 } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport type { OpenAPIParameter } from \"better-call\";\nimport { jwtVerify, SignJWT } from \"jose\";\nimport * as z from \"zod\";\nimport { APIError, getSessionFromCtx, sessionMiddleware } from \"../../api\";\nimport { parseSetCookieHeader } from \"../../cookies\";\nimport {\n\tgenerateRandomString,\n\tsymmetricDecrypt,\n\tsymmetricEncrypt,\n} from \"../../crypto\";\nimport { mergeSchema } from \"../../db\";\nimport { HIDE_METADATA } from \"../../utils\";\nimport type { jwt } from \"../jwt\";\nimport { getJwtToken, verifyJWT } from \"../jwt\";\nimport { authorize } from \"./authorize\";\nimport type { OAuthApplication } from \"./schema\";\nimport { schema } from \"./schema\";\nimport type {\n\tClient,\n\tCodeVerificationValue,\n\tOAuthAccessToken,\n\tOIDCMetadata,\n\tOIDCOptions,\n} from \"./types\";\nimport { defaultClientSecretHasher } from \"./utils\";\nimport { parsePrompt } from \"./utils/prompt\";\n\nconst getJwtPlugin = (ctx: GenericEndpointContext) => {\n\treturn ctx.context.options.plugins?.find(\n\t\t(plugin) => plugin.id === \"jwt\",\n\t) as ReturnType<typeof jwt>;\n};\n\n/**\n * Get a client by ID, checking trusted clients first, then database\n */\nexport async function getClient(\n\tclientId: string,\n\ttrustedClients: (Client & { skipConsent?: boolean | undefined })[] = [],\n): Promise<(Client & { skipConsent?: boolean | undefined }) | null> {\n\tconst {\n\t\tcontext: { adapter },\n\t} = await getCurrentAuthContext();\n\tconst trustedClient = trustedClients.find(\n\t\t(client) => client.clientId === clientId,\n\t);\n\tif (trustedClient) {\n\t\treturn trustedClient;\n\t}\n\treturn adapter\n\t\t.findOne<OAuthApplication>({\n\t\t\tmodel: \"oauthApplication\",\n\t\t\twhere: [{ field: \"clientId\", value: clientId }],\n\t\t})\n\t\t.then((res) => {\n\t\t\tif (!res) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// omit sensitive fields\n\t\t\treturn {\n\t\t\t\tclientId: res.clientId,\n\t\t\t\tclientSecret: res.clientSecret,\n\t\t\t\ttype: res.type,\n\t\t\t\tname: res.name,\n\t\t\t\ticon: res.icon,\n\t\t\t\tdisabled: res.disabled,\n\t\t\t\tredirectUrls: (res.redirectUrls ?? \"\").split(\",\"),\n\t\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {},\n\t\t\t} satisfies Client;\n\t\t});\n}\n\nexport const getMetadata = (\n\tctx: GenericEndpointContext,\n\toptions?: OIDCOptions | undefined,\n): OIDCMetadata => {\n\tconst jwtPlugin = getJwtPlugin(ctx);\n\tconst issuer =\n\t\tjwtPlugin && jwtPlugin.options?.jwt && jwtPlugin.options.jwt.issuer\n\t\t\t? jwtPlugin.options.jwt.issuer\n\t\t\t: (ctx.context.options.baseURL as string);\n\tconst baseURL = ctx.context.baseURL;\n\tconst supportedAlgs = options?.useJWTPlugin\n\t\t? [\"RS256\", \"EdDSA\", \"none\"]\n\t\t: [\"HS256\", \"none\"];\n\treturn {\n\t\tissuer,\n\t\tauthorization_endpoint: `${baseURL}/oauth2/authorize`,\n\t\ttoken_endpoint: `${baseURL}/oauth2/token`,\n\t\tuserinfo_endpoint: `${baseURL}/oauth2/userinfo`,\n\t\tjwks_uri: `${baseURL}/jwks`,\n\t\tregistration_endpoint: `${baseURL}/oauth2/register`,\n\t\tend_session_endpoint: `${baseURL}/oauth2/endsession`,\n\t\tscopes_supported: [\"openid\", \"profile\", \"email\", \"offline_access\"],\n\t\tresponse_types_supported: [\"code\"],\n\t\tresponse_modes_supported: [\"query\"],\n\t\tgrant_types_supported: [\"authorization_code\", \"refresh_token\"],\n\t\tacr_values_supported: [\n\t\t\t\"urn:mace:incommon:iap:silver\",\n\t\t\t\"urn:mace:incommon:iap:bronze\",\n\t\t],\n\t\tsubject_types_supported: [\"public\"],\n\t\tid_token_signing_alg_values_supported: supportedAlgs,\n\t\ttoken_endpoint_auth_methods_supported: [\n\t\t\t\"client_secret_basic\",\n\t\t\t\"client_secret_post\",\n\t\t\t\"none\",\n\t\t],\n\t\tcode_challenge_methods_supported: [\"S256\"],\n\t\tclaims_supported: [\n\t\t\t\"sub\",\n\t\t\t\"iss\",\n\t\t\t\"aud\",\n\t\t\t\"exp\",\n\t\t\t\"nbf\",\n\t\t\t\"iat\",\n\t\t\t\"jti\",\n\t\t\t\"email\",\n\t\t\t\"email_verified\",\n\t\t\t\"name\",\n\t\t],\n\t\t...options?.metadata,\n\t};\n};\n\nconst oAuthConsentBodySchema = z.object({\n\taccept: z.boolean(),\n\tconsent_code: z.string().optional().nullish(),\n});\n\nconst oAuth2TokenBodySchema = z.record(z.any(), z.any());\n\nconst registerOAuthApplicationBodySchema = z.object({\n\tredirect_uris: z.array(z.string()).meta({\n\t\tdescription:\n\t\t\t'A list of redirect URIs. Eg: [\"https://client.example.com/callback\"]',\n\t}),\n\ttoken_endpoint_auth_method: z\n\t\t.enum([\"none\", \"client_secret_basic\", \"client_secret_post\"])\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The authentication method for the token endpoint. Eg: \"client_secret_basic\"',\n\t\t})\n\t\t.default(\"client_secret_basic\")\n\t\t.optional(),\n\tgrant_types: z\n\t\t.array(\n\t\t\tz.enum([\n\t\t\t\t\"authorization_code\",\n\t\t\t\t\"implicit\",\n\t\t\t\t\"password\",\n\t\t\t\t\"client_credentials\",\n\t\t\t\t\"refresh_token\",\n\t\t\t\t\"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n\t\t\t\t\"urn:ietf:params:oauth:grant-type:saml2-bearer\",\n\t\t\t]),\n\t\t)\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The grant types supported by the application. Eg: [\"authorization_code\"]',\n\t\t})\n\t\t.default([\"authorization_code\"])\n\t\t.optional(),\n\tresponse_types: z\n\t\t.array(z.enum([\"code\", \"token\"]))\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The response types supported by the application. Eg: [\"code\"]',\n\t\t})\n\t\t.default([\"code\"])\n\t\t.optional(),\n\tclient_name: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: 'The name of the application. Eg: \"My App\"',\n\t\t})\n\t\t.optional(),\n\tclient_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application. Eg: \"https://client.example.com\"',\n\t\t})\n\t\t.optional(),\n\tlogo_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application logo. Eg: \"https://client.example.com/logo.png\"',\n\t\t})\n\t\t.optional(),\n\tscope: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The scopes supported by the application. Separated by spaces. Eg: \"profile email\"',\n\t\t})\n\t\t.optional(),\n\tcontacts: z\n\t\t.array(z.string())\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The contact information for the application. Eg: [\"admin@example.com\"]',\n\t\t})\n\t\t.optional(),\n\ttos_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application terms of service. Eg: \"https://client.example.com/tos\"',\n\t\t})\n\t\t.optional(),\n\tpolicy_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application privacy policy. Eg: \"https://client.example.com/policy\"',\n\t\t})\n\t\t.optional(),\n\tjwks_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application JWKS. Eg: \"https://client.example.com/jwks\"',\n\t\t})\n\t\t.optional(),\n\tjwks: z\n\t\t.record(z.any(), z.any())\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The JWKS of the application. Eg: {\"keys\": [{\"kty\": \"RSA\", \"alg\": \"RS256\", \"use\": \"sig\", \"n\": \"...\", \"e\": \"...\"}]}',\n\t\t})\n\t\t.optional(),\n\tmetadata: z\n\t\t.record(z.any(), z.any())\n\t\t.meta({\n\t\t\tdescription: 'The metadata of the application. Eg: {\"key\": \"value\"}',\n\t\t})\n\t\t.optional(),\n\tsoftware_id: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: 'The software ID of the application. Eg: \"my-software\"',\n\t\t})\n\t\t.optional(),\n\tsoftware_version: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: 'The software version of the application. Eg: \"1.0.0\"',\n\t\t})\n\t\t.optional(),\n\tsoftware_statement: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The software statement of the application.\",\n\t\t})\n\t\t.optional(),\n});\n\nconst DEFAULT_CODE_EXPIRES_IN = 600;\nconst DEFAULT_ACCESS_TOKEN_EXPIRES_IN = 3600;\nconst DEFAULT_REFRESH_TOKEN_EXPIRES_IN = 604800;\n\n/**\n * OpenID Connect (OIDC) plugin for Better Auth. This plugin implements the\n * authorization code flow and the token exchange flow. It also implements the\n * userinfo endpoint.\n *\n * @param options - The options for the OIDC plugin.\n * @returns A Better Auth plugin.\n */\nexport const oidcProvider = (options: OIDCOptions) => {\n\tconst modelName = {\n\t\toauthClient: \"oauthApplication\",\n\t\toauthAccessToken: \"oauthAccessToken\",\n\t\toauthConsent: \"oauthConsent\",\n\t};\n\n\tconst opts = {\n\t\tcodeExpiresIn: DEFAULT_CODE_EXPIRES_IN,\n\t\tdefaultScope: \"openid\",\n\t\taccessTokenExpiresIn: DEFAULT_ACCESS_TOKEN_EXPIRES_IN,\n\t\trefreshTokenExpiresIn: DEFAULT_REFRESH_TOKEN_EXPIRES_IN,\n\t\tallowPlainCodeChallengeMethod: true,\n\t\tstoreClientSecret: \"plain\" as const,\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...(options?.scopes || []),\n\t\t],\n\t};\n\n\tconst trustedClients = options.trustedClients || [];\n\n\t/**\n\t * Store client secret according to the configured storage method\n\t */\n\tasync function storeClientSecret(\n\t\tctx: GenericEndpointContext,\n\t\tclientSecret: string,\n\t) {\n\t\tif (opts.storeClientSecret === \"encrypted\") {\n\t\t\treturn await symmetricEncrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: clientSecret,\n\t\t\t});\n\t\t}\n\t\tif (opts.storeClientSecret === \"hashed\") {\n\t\t\treturn await defaultClientSecretHasher(clientSecret);\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeClientSecret === \"object\" &&\n\t\t\t\"hash\" in opts.storeClientSecret\n\t\t) {\n\t\t\treturn await opts.storeClientSecret.hash(clientSecret);\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeClientSecret === \"object\" &&\n\t\t\t\"encrypt\" in opts.storeClientSecret\n\t\t) {\n\t\t\treturn await opts.storeClientSecret.encrypt(clientSecret);\n\t\t}\n\n\t\treturn clientSecret;\n\t}\n\n\t/**\n\t * Verify stored client secret against provided client secret\n\t */\n\tasync function verifyStoredClientSecret(\n\t\tctx: GenericEndpointContext,\n\t\tstoredClientSecret: string,\n\t\tclientSecret: string,\n\t): Promise<boolean> {\n\t\tif (opts.storeClientSecret === \"encrypted\") {\n\t\t\treturn (\n\t\t\t\t(await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: storedClientSecret,\n\t\t\t\t})) === clientSecret\n\t\t\t);\n\t\t}\n\t\tif (opts.storeClientSecret === \"hashed\") {\n\t\t\tconst hashedClientSecret = await defaultClientSecretHasher(clientSecret);\n\t\t\treturn hashedClientSecret === storedClientSecret;\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeClientSecret === \"object\" &&\n\t\t\t\"hash\" in opts.storeClientSecret\n\t\t) {\n\t\t\tconst hashedClientSecret =\n\t\t\t\tawait opts.storeClientSecret.hash(clientSecret);\n\t\t\treturn hashedClientSecret === storedClientSecret;\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeClientSecret === \"object\" &&\n\t\t\t\"decrypt\" in opts.storeClientSecret\n\t\t) {\n\t\t\tconst decryptedClientSecret =\n\t\t\t\tawait opts.storeClientSecret.decrypt(storedClientSecret);\n\t\t\treturn decryptedClientSecret === clientSecret;\n\t\t}\n\n\t\treturn clientSecret === storedClientSecret;\n\t}\n\n\treturn {\n\t\tid: \"oidc\",\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst loginPromptCookie = await ctx.getSignedCookie(\n\t\t\t\t\t\t\t\"oidc_login_prompt\",\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\t\tconst parsedSetCookieHeader = parseSetCookieHeader(\n\t\t\t\t\t\t\tctx.context.responseHeaders?.get(\"set-cookie\") || \"\",\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst hasSessionToken = parsedSetCookieHeader.has(cookieName);\n\t\t\t\t\t\tif (!loginPromptCookie || !hasSessionToken) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctx.setCookie(\"oidc_login_prompt\", \"\", {\n\t\t\t\t\t\t\tmaxAge: 0,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst sessionCookie = parsedSetCookieHeader.get(cookieName)?.value;\n\t\t\t\t\t\tconst sessionToken = sessionCookie?.split(\".\")[0]!;\n\t\t\t\t\t\tif (!sessionToken) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst session =\n\t\t\t\t\t\t\t(await ctx.context.internalAdapter.findSession(sessionToken)) ||\n\t\t\t\t\t\t\tctx.context.newSession;\n\t\t\t\t\t\tif (!session) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctx.query = JSON.parse(loginPromptCookie);\n\n\t\t\t\t\t\t// Remove \"login\" from prompt since user just logged in\n\t\t\t\t\t\tconst promptSet = parsePrompt(String(ctx.query?.prompt));\n\t\t\t\t\t\tif (promptSet.has(\"login\")) {\n\t\t\t\t\t\t\tconst newPromptSet = new Set(promptSet);\n\t\t\t\t\t\t\tnewPromptSet.delete(\"login\");\n\t\t\t\t\t\t\tctx.query = {\n\t\t\t\t\t\t\t\t...ctx.query,\n\t\t\t\t\t\t\t\tprompt: Array.from(newPromptSet).join(\" \"),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tctx.context.session = session;\n\t\t\t\t\t\tconst response = await authorize(ctx, opts);\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tendpoints: {\n\t\t\tgetOpenIdConfig: createAuthEndpoint(\n\t\t\t\t\"/.well-known/openid-configuration\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\toperationId: \"getOpenIdConfig\",\n\t\t\t\t\tmetadata: HIDE_METADATA,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst metadata = getMetadata(ctx, options);\n\t\t\t\t\treturn ctx.json(metadata);\n\t\t\t\t},\n\t\t\t),\n\t\t\toAuth2authorize: createAuthEndpoint(\n\t\t\t\t\"/oauth2/authorize\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\toperationId: \"oauth2Authorize\",\n\t\t\t\t\tquery: z.record(z.string(), z.any()),\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Authorize an OAuth2 request\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Authorization response generated successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Authorization response, contents depend on the authorize function implementation\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\treturn authorize(ctx, opts);\n\t\t\t\t},\n\t\t\t),\n\t\t\toAuthConsent: createAuthEndpoint(\n\t\t\t\t\"/oauth2/consent\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\toperationId: \"oauth2Consent\",\n\t\t\t\t\tbody: oAuthConsentBodySchema,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Handle OAuth2 consent. Supports both URL parameter-based flows (consent_code in body) and cookie-based flows (signed cookie).\",\n\t\t\t\t\t\t\trequestBody: {\n\t\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\taccept: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Whether the user accepts or denies the consent request\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tconsent_code: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The consent code from the authorization request. Optional if using cookie-based flow.\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trequired: [\"accept\"],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Consent processed successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tredirectURI: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The URI to redirect to, either with an authorization code or an error\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"redirectURI\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\t// Support both consent flow methods:\n\t\t\t\t\t// 1. URL parameter-based: consent_code in request body (standard OAuth2 pattern)\n\t\t\t\t\t// 2. Cookie-based: using signed cookie for stateful consent flows\n\t\t\t\t\tlet consentCode: string | null = ctx.body.consent_code || null;\n\n\t\t\t\t\tif (!consentCode) {\n\t\t\t\t\t\t// Check for cookie-based consent flow\n\t\t\t\t\t\tconst cookieValue = await ctx.getSignedCookie(\n\t\t\t\t\t\t\t\"oidc_consent_prompt\",\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (cookieValue) {\n\t\t\t\t\t\t\tconsentCode = cookieValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!consentCode) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\"consent_code is required (either in body or cookie)\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst verification =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\tconsentCode,\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!verification) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"Invalid code\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (verification.expiresAt < new Date()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"Code expired\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clear the cookie\n\t\t\t\t\tctx.setCookie(\"oidc_consent_prompt\", \"\", {\n\t\t\t\t\t\tmaxAge: 0,\n\t\t\t\t\t});\n\n\t\t\t\t\tconst value = JSON.parse(verification.value) as CodeVerificationValue;\n\t\t\t\t\tif (!value.requireConsent) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"Consent not required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!ctx.body.accept) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\t\tverification.id,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\tredirectURI: `${value.redirectURI}?error=access_denied&error_description=User denied access`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\t\t\t\t\tconst codeExpiresInMs =\n\t\t\t\t\t\t(opts?.codeExpiresIn ?? DEFAULT_CODE_EXPIRES_IN) * 1000;\n\t\t\t\t\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\t\tverification.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvalue: JSON.stringify({\n\t\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t\trequireConsent: false,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tidentifier: code,\n\t\t\t\t\t\t\texpiresAt,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthConsent,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tclientId: value.clientId,\n\t\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\t\tscopes: value.scope.join(\" \"),\n\t\t\t\t\t\t\tconsentGiven: true,\n\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tconst redirectURI = new URL(value.redirectURI);\n\t\t\t\t\tredirectURI.searchParams.set(\"code\", code);\n\t\t\t\t\tif (value.state) redirectURI.searchParams.set(\"state\", value.state);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tredirectURI: redirectURI.toString(),\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\toAuth2token: createAuthEndpoint(\n\t\t\t\t\"/oauth2/token\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\toperationId: \"oauth2Token\",\n\t\t\t\t\tbody: oAuth2TokenBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\t\tallowedMediaTypes: [\n\t\t\t\t\t\t\t\"application/x-www-form-urlencoded\",\n\t\t\t\t\t\t\t\"application/json\",\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tlet { body } = ctx;\n\t\t\t\t\tif (!body) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"request body not found\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (body instanceof FormData) {\n\t\t\t\t\t\tbody = Object.fromEntries(body.entries());\n\t\t\t\t\t}\n\t\t\t\t\tif (!(body instanceof Object)) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"request body is not an object\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tlet { client_id, client_secret } = body;\n\t\t\t\t\tconst authorization =\n\t\t\t\t\t\tctx.request?.headers.get(\"authorization\") || null;\n\t\t\t\t\tif (\n\t\t\t\t\t\tauthorization &&\n\t\t\t\t\t\t!client_id &&\n\t\t\t\t\t\t!client_secret &&\n\t\t\t\t\t\tauthorization.startsWith(\"Basic \")\n\t\t\t\t\t) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst encoded = authorization.replace(\"Basic \", \"\");\n\t\t\t\t\t\t\tconst decoded = new TextDecoder().decode(base64.decode(encoded));\n\t\t\t\t\t\t\tif (!decoded.includes(\":\")) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst [id, secret] = decoded.split(\":\");\n\t\t\t\t\t\t\tif (!id || !secret) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclient_id = id;\n\t\t\t\t\t\t\tclient_secret = secret;\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\tconst iat = Math.floor(now / 1000);\n\t\t\t\t\tconst exp = iat + (opts.accessTokenExpiresIn ?? 3600);\n\n\t\t\t\t\tconst accessTokenExpiresAt = new Date(exp * 1000);\n\t\t\t\t\tconst refreshTokenExpiresAt = new Date(\n\t\t\t\t\t\t(iat + (opts.refreshTokenExpiresIn ?? 604800)) * 1000,\n\t\t\t\t\t);\n\n\t\t\t\t\tconst {\n\t\t\t\t\t\tgrant_type,\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tredirect_uri,\n\t\t\t\t\t\trefresh_token,\n\t\t\t\t\t\tcode_verifier,\n\t\t\t\t\t} = body;\n\t\t\t\t\tif (grant_type === \"refresh_token\") {\n\t\t\t\t\t\tif (!refresh_token) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror_description: \"refresh_token is required\",\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst token = await ctx.context.adapter.findOne<OAuthAccessToken>({\n\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield: \"refreshToken\",\n\t\t\t\t\t\t\t\t\tvalue: refresh_token.toString(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (!token) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid refresh token\",\n\t\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (token.clientId !== client_id?.toString()) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (token.refreshTokenExpiresAt < new Date()) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"refresh token expired\",\n\t\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\t\tconst newRefreshToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\n\t\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\t\t\trefreshToken: newRefreshToken,\n\t\t\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\t\tuserId: token.userId,\n\t\t\t\t\t\t\t\tscopes: token.scopes,\n\t\t\t\t\t\t\t\tcreatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\t\tupdatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\t\trefresh_token: newRefreshToken,\n\t\t\t\t\t\t\tscope: token.scopes,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!code) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (options.requirePKCE && !code_verifier) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t/**\n\t\t\t\t\t * We need to check if the code is valid before we can proceed\n\t\t\t\t\t * with the rest of the request.\n\t\t\t\t\t */\n\t\t\t\t\tconst verificationValue =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\tcode.toString(),\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!verificationValue) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid code\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (verificationValue.expiresAt < new Date()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"code expired\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t);\n\t\t\t\t\tif (!client_id) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"client_id is required\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (!grant_type) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"grant_type is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (grant_type !== \"authorization_code\") {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"grant_type must be 'authorization_code'\",\n\t\t\t\t\t\t\terror: \"unsupported_grant_type\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!redirect_uri) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"redirect_uri is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst client = await getClient(client_id.toString(), trustedClients);\n\t\t\t\t\tif (!client) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (client.disabled) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"client is disabled\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = JSON.parse(\n\t\t\t\t\t\tverificationValue.value,\n\t\t\t\t\t) as CodeVerificationValue;\n\t\t\t\t\tif (value.clientId !== client_id.toString()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (value.redirectURI !== redirect_uri.toString()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid redirect_uri\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (value.codeChallenge && !code_verifier) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (client.type === \"public\") {\n\t\t\t\t\t\t// For public clients (type: 'public'), validate PKCE instead of client_secret\n\t\t\t\t\t\tif (!code_verifier) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"code verifier is required for public clients\",\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// PKCE validation happens later in the flow, so we skip client_secret validation\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!client.clientSecret || !client_secret) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"client_secret is required for confidential clients\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst isValidSecret = await verifyStoredClientSecret(\n\t\t\t\t\t\t\tctx,\n\t\t\t\t\t\t\tclient.clientSecret,\n\t\t\t\t\t\t\tclient_secret.toString(),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!isValidSecret) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid client_secret\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst challenge =\n\t\t\t\t\t\tvalue.codeChallengeMethod === \"plain\"\n\t\t\t\t\t\t\t? code_verifier\n\t\t\t\t\t\t\t: await createHash(\"SHA-256\", \"base64urlnopad\").digest(\n\t\t\t\t\t\t\t\t\tcode_verifier,\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\tif (challenge !== value.codeChallenge) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"code verification failed\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst requestedScopes = value.scope;\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t);\n\t\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst refreshToken = generateRandomString(32, \"A-Z\", \"a-z\");\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\t\tscopes: requestedScopes.join(\" \"),\n\t\t\t\t\t\t\tcreatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\tupdatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\t\t\tvalue.userId,\n\t\t\t\t\t);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst profile = {\n\t\t\t\t\t\tgiven_name: user.name.split(\" \")[0]!,\n\t\t\t\t\t\tfamily_name: user.name.split(\" \")[1]!,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\tprofile: user.image,\n\t\t\t\t\t\tupdated_at: new Date(user.updatedAt).toISOString(),\n\t\t\t\t\t};\n\t\t\t\t\tconst email = {\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temail_verified: user.emailVerified,\n\t\t\t\t\t};\n\t\t\t\t\tconst userClaims = {\n\t\t\t\t\t\t...(requestedScopes.includes(\"profile\") ? profile : {}),\n\t\t\t\t\t\t...(requestedScopes.includes(\"email\") ? email : {}),\n\t\t\t\t\t};\n\n\t\t\t\t\tconst additionalUserClaims = options.getAdditionalUserInfoClaim\n\t\t\t\t\t\t? await options.getAdditionalUserInfoClaim(\n\t\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\trequestedScopes,\n\t\t\t\t\t\t\t\tclient,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: {};\n\n\t\t\t\t\tconst payload = {\n\t\t\t\t\t\tsub: user.id,\n\t\t\t\t\t\taud: client_id.toString(),\n\t\t\t\t\t\tiat: iat,\n\t\t\t\t\t\tauth_time: ctx.context.session\n\t\t\t\t\t\t\t? new Date(ctx.context.session.session.createdAt).getTime()\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tnonce: value.nonce,\n\t\t\t\t\t\tacr: \"urn:mace:incommon:iap:silver\", // default to silver -  this should be configurable and should be validated against the client's metadata\n\t\t\t\t\t\t...userClaims,\n\t\t\t\t\t\t...additionalUserClaims,\n\t\t\t\t\t};\n\t\t\t\t\tconst expirationTime =\n\t\t\t\t\t\tMath.floor(Date.now() / 1000) +\n\t\t\t\t\t\t(opts?.accessTokenExpiresIn ?? DEFAULT_ACCESS_TOKEN_EXPIRES_IN);\n\n\t\t\t\t\tlet idToken: string;\n\n\t\t\t\t\t// The JWT plugin is enabled, so we use the JWKS keys to sign\n\t\t\t\t\tif (options.useJWTPlugin) {\n\t\t\t\t\t\tconst jwtPlugin = getJwtPlugin(ctx);\n\t\t\t\t\t\tif (!jwtPlugin) {\n\t\t\t\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\t\t\t\"OIDC: `useJWTPlugin` is enabled but the JWT plugin is not available. Make sure you have the JWT Plugin in your plugins array or set `useJWTPlugin` to false.\",\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\t\terror_description: \"JWT plugin is not enabled\",\n\t\t\t\t\t\t\t\terror: \"internal_server_error\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tidToken = await getJwtToken(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t...ctx,\n\t\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\t\t...ctx.context,\n\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\tid: generateRandomString(32, \"a-z\", \"A-Z\"),\n\t\t\t\t\t\t\t\t\t\t\tcreatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\t\t\t\t\tupdatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\t\t\t\texpiresAt: accessTokenExpiresAt,\n\t\t\t\t\t\t\t\t\t\t\ttoken: accessToken,\n\t\t\t\t\t\t\t\t\t\t\tipAddress: ctx.request?.headers.get(\"x-forwarded-for\"),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t...jwtPlugin.options,\n\t\t\t\t\t\t\t\tjwt: {\n\t\t\t\t\t\t\t\t\t...jwtPlugin.options?.jwt,\n\t\t\t\t\t\t\t\t\tgetSubject: () => user.id,\n\t\t\t\t\t\t\t\t\taudience: client_id.toString(),\n\t\t\t\t\t\t\t\t\tissuer:\n\t\t\t\t\t\t\t\t\t\tjwtPlugin.options?.jwt?.issuer ??\n\t\t\t\t\t\t\t\t\t\tctx.context.options.baseURL,\n\t\t\t\t\t\t\t\t\texpirationTime,\n\t\t\t\t\t\t\t\t\tdefinePayload: () => payload,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// If the JWT token is not enabled, create a key and use it to sign\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidToken = await new SignJWT(payload)\n\t\t\t\t\t\t\t.setProtectedHeader({ alg: \"HS256\" })\n\t\t\t\t\t\t\t.setIssuedAt(iat)\n\t\t\t\t\t\t\t.setExpirationTime(accessTokenExpiresAt)\n\t\t\t\t\t\t\t.sign(new TextEncoder().encode(client.clientSecret));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ctx.json(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\t\trefresh_token: requestedScopes.includes(\"offline_access\")\n\t\t\t\t\t\t\t\t? refreshToken\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\tscope: requestedScopes.join(\" \"),\n\t\t\t\t\t\t\tid_token: requestedScopes.includes(\"openid\")\n\t\t\t\t\t\t\t\t? idToken\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\t\t\tPragma: \"no-cache\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t\toAuth2userInfo: createAuthEndpoint(\n\t\t\t\t\"/oauth2/userinfo\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\toperationId: \"oauth2Userinfo\",\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Get OAuth2 user information\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"User information retrieved successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsub: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Subject identifier (user ID)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's email address, included if 'email' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's full name, included if 'profile' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tpicture: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's profile picture URL, included if 'profile' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tgiven_name: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's given name, included if 'profile' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tfamily_name: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's family name, included if 'profile' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temail_verified: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Whether the email is verified, included if 'email' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"sub\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tif (!ctx.request) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"request not found\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst authorization = ctx.request.headers.get(\"authorization\");\n\t\t\t\t\tif (!authorization) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"authorization header not found\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst token = authorization.replace(\"Bearer \", \"\");\n\t\t\t\t\tconst accessToken =\n\t\t\t\t\t\tawait ctx.context.adapter.findOne<OAuthAccessToken>({\n\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield: \"accessToken\",\n\t\t\t\t\t\t\t\t\tvalue: token,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\tif (!accessToken) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid access token\",\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (accessToken.accessTokenExpiresAt < new Date()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"The Access Token expired\",\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst client = await getClient(accessToken.clientId, trustedClients);\n\t\t\t\t\tif (!client) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"client not found\",\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\t\t\taccessToken.userId,\n\t\t\t\t\t);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst requestedScopes = accessToken.scopes.split(\" \");\n\t\t\t\t\tconst baseUserClaims = {\n\t\t\t\t\t\tsub: user.id,\n\t\t\t\t\t\temail: requestedScopes.includes(\"email\") ? user.email : undefined,\n\t\t\t\t\t\tname: requestedScopes.includes(\"profile\") ? user.name : undefined,\n\t\t\t\t\t\tpicture: requestedScopes.includes(\"profile\")\n\t\t\t\t\t\t\t? user.image\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tgiven_name: requestedScopes.includes(\"profile\")\n\t\t\t\t\t\t\t? user.name.split(\" \")[0]!\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tfamily_name: requestedScopes.includes(\"profile\")\n\t\t\t\t\t\t\t? user.name.split(\" \")[1]!\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\temail_verified: requestedScopes.includes(\"email\")\n\t\t\t\t\t\t\t? user.emailVerified\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t};\n\t\t\t\t\tconst userClaims = options.getAdditionalUserInfoClaim\n\t\t\t\t\t\t? await options.getAdditionalUserInfoClaim(\n\t\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\trequestedScopes,\n\t\t\t\t\t\t\t\tclient,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: baseUserClaims;\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t...baseUserClaims,\n\t\t\t\t\t\t...userClaims,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/oauth2/register`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.registerOAuthApplication`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.oauth2.register`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/oidc-provider#api-method-oauth2-register)\n\t\t\t */\n\t\t\tregisterOAuthApplication: createAuthEndpoint(\n\t\t\t\t\"/oauth2/register\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: registerOAuthApplicationBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Register an OAuth2 application\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"OAuth2 application registered successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Additional metadata for the application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tclientSecret: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Secret key for the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tredirectURLs: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\titems: { type: \"string\", format: \"uri\" },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"List of allowed redirect URLs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Type of the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"web\"],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tauthenticationScheme: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Authentication scheme used by the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"client_secret\"],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the client is disabled\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [false],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"ID of the user who registered the client, null if registered anonymously\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Creation timestamp\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Last update timestamp\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"clientId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"clientSecret\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"redirectURLs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"type\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"authenticationScheme\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst body = ctx.body;\n\t\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\n\t\t\t\t\t// Check authorization\n\t\t\t\t\tif (!session && !options.allowDynamicClientRegistration) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\"Authentication required for client registration\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate redirect URIs for redirect-based flows\n\t\t\t\t\tif (\n\t\t\t\t\t\t(!body.grant_types ||\n\t\t\t\t\t\t\tbody.grant_types.includes(\"authorization_code\") ||\n\t\t\t\t\t\t\tbody.grant_types.includes(\"implicit\")) &&\n\t\t\t\t\t\t(!body.redirect_uris || body.redirect_uris.length === 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror: \"invalid_redirect_uri\",\n\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\"Redirect URIs are required for authorization_code and implicit grant types\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate correlation between grant_types and response_types\n\t\t\t\t\tif (body.grant_types && body.response_types) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tbody.grant_types.includes(\"authorization_code\") &&\n\t\t\t\t\t\t\t!body.response_types.includes(\"code\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"When 'authorization_code' grant type is used, 'code' response type must be included\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tbody.grant_types.includes(\"implicit\") &&\n\t\t\t\t\t\t\t!body.response_types.includes(\"token\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"When 'implicit' grant type is used, 'token' response type must be included\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst clientId =\n\t\t\t\t\t\toptions.generateClientId?.() ||\n\t\t\t\t\t\tgenerateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst clientSecret =\n\t\t\t\t\t\toptions.generateClientSecret?.() ||\n\t\t\t\t\t\tgenerateRandomString(32, \"a-z\", \"A-Z\");\n\n\t\t\t\t\tconst storedClientSecret = await storeClientSecret(ctx, clientSecret);\n\n\t\t\t\t\t// Create the client with the existing schema\n\t\t\t\t\tconst client: Client = await ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tname: body.client_name,\n\t\t\t\t\t\t\ticon: body.logo_uri,\n\t\t\t\t\t\t\tmetadata: body.metadata ? JSON.stringify(body.metadata) : null,\n\t\t\t\t\t\t\tclientId: clientId,\n\t\t\t\t\t\t\tclientSecret: storedClientSecret,\n\t\t\t\t\t\t\tredirectUrls: body.redirect_uris.join(\",\"),\n\t\t\t\t\t\t\ttype: \"web\",\n\t\t\t\t\t\t\tauthenticationScheme:\n\t\t\t\t\t\t\t\tbody.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\t\tuserId: session?.session.userId,\n\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\t// Format the response according to RFC7591\n\t\t\t\t\treturn ctx.json(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclient_id: clientId,\n\t\t\t\t\t\t\t...(client.type !== \"public\"\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\tclient_secret: clientSecret,\n\t\t\t\t\t\t\t\t\t\tclient_secret_expires_at: 0, // 0 means it doesn't expire\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t\tclient_id_issued_at: Math.floor(Date.now() / 1000),\n\t\t\t\t\t\t\tclient_secret_expires_at: 0, // 0 means it doesn't expire\n\t\t\t\t\t\t\tredirect_uris: body.redirect_uris,\n\t\t\t\t\t\t\ttoken_endpoint_auth_method:\n\t\t\t\t\t\t\t\tbody.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\t\tgrant_types: body.grant_types || [\"authorization_code\"],\n\t\t\t\t\t\t\tresponse_types: body.response_types || [\"code\"],\n\t\t\t\t\t\t\tclient_name: body.client_name,\n\t\t\t\t\t\t\tclient_uri: body.client_uri,\n\t\t\t\t\t\t\tlogo_uri: body.logo_uri,\n\t\t\t\t\t\t\tscope: body.scope,\n\t\t\t\t\t\t\tcontacts: body.contacts,\n\t\t\t\t\t\t\ttos_uri: body.tos_uri,\n\t\t\t\t\t\t\tpolicy_uri: body.policy_uri,\n\t\t\t\t\t\t\tjwks_uri: body.jwks_uri,\n\t\t\t\t\t\t\tjwks: body.jwks,\n\t\t\t\t\t\t\tsoftware_id: body.software_id,\n\t\t\t\t\t\t\tsoftware_version: body.software_version,\n\t\t\t\t\t\t\tsoftware_statement: body.software_statement,\n\t\t\t\t\t\t\tmetadata: body.metadata,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstatus: 201,\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\t\t\tPragma: \"no-cache\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t\tgetOAuthClient: createAuthEndpoint(\n\t\t\t\t\"/oauth2/client/:id\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Get OAuth2 client details\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"OAuth2 client retrieved successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"clientId\", \"name\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (\n\t\t\t\t\tctx,\n\t\t\t\t): Promise<{\n\t\t\t\t\tclientId: string;\n\t\t\t\t\tname: string;\n\t\t\t\t\ticon: string | null;\n\t\t\t\t}> => {\n\t\t\t\t\tconst client = await getClient(ctx.params.id, trustedClients);\n\t\t\t\t\tif (!client) {\n\t\t\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\t\t\terror_description: \"client not found\",\n\t\t\t\t\t\t\terror: \"not_found\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tclientId: client.clientId,\n\t\t\t\t\t\tname: client.name,\n\t\t\t\t\t\ticon: client.icon || null,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * GET/POST `/oauth2/endsession`\n\t\t\t *\n\t\t\t * Implements RP-Initiated Logout as per OpenID Connect RP-Initiated Logout 1.0.\n\t\t\t * Allows relying parties to request that an OpenID Provider log out the end-user.\n\t\t\t *\n\t\t\t * @see [OpenID Connect RP-Initiated Logout Spec](https://openid.net/specs/openid-connect-rpinitiated-1_0.html)\n\t\t\t */\n\t\t\tendSession: createAuthEndpoint(\n\t\t\t\t\"/oauth2/endsession\",\n\t\t\t\t{\n\t\t\t\t\tmethod: [\"GET\", \"POST\"],\n\t\t\t\t\tquery: z\n\t\t\t\t\t\t.object({\n\t\t\t\t\t\t\tid_token_hint: z.string().optional(),\n\t\t\t\t\t\t\tlogout_hint: z.string().optional(),\n\t\t\t\t\t\t\tclient_id: z.string().optional(),\n\t\t\t\t\t\t\tpost_logout_redirect_uri: z.string().optional(),\n\t\t\t\t\t\t\tstate: z.string().optional(),\n\t\t\t\t\t\t\tui_locales: z.string().optional(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"RP-Initiated Logout endpoint. Logs out the end-user and optionally redirects to a post-logout URI.\",\n\t\t\t\t\t\t\tparameters: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"id_token_hint\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"Previously issued ID Token passed as a hint about the End-User's current authenticated session\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"logout_hint\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"Hint to the Authorization Server about the End-User that is logging out\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"client_id\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"OAuth 2.0 Client Identifier. Required if post_logout_redirect_uri is used without id_token_hint\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"post_logout_redirect_uri\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"URL to which the RP is requesting that the End-User's User Agent be redirected after a logout has been performed\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\", format: \"uri\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"state\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"Opaque value used by the RP to maintain state between the logout request and the callback\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"ui_locales\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"End-User's preferred languages and scripts for the user interface\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t] as OpenAPIParameter[],\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"302\": {\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"Redirect to post_logout_redirect_uri or logout confirmation page\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Logout completed successfully\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst { id_token_hint, client_id, post_logout_redirect_uri, state } =\n\t\t\t\t\t\tctx.query || {};\n\n\t\t\t\t\tlet validatedClientId: string | null = null;\n\t\t\t\t\tlet validatedUserId: string | null = null;\n\n\t\t\t\t\t// Validate id_token_hint if provided\n\t\t\t\t\tif (id_token_hint) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst jwtPlugin = getJwtPlugin(ctx);\n\t\t\t\t\t\t\tif (jwtPlugin && jwtPlugin.options && options?.useJWTPlugin) {\n\t\t\t\t\t\t\t\t// For JWT plugin tokens, verify using JWKS\n\t\t\t\t\t\t\t\tconst verified = await verifyJWT(\n\t\t\t\t\t\t\t\t\tid_token_hint,\n\t\t\t\t\t\t\t\t\tjwtPlugin.options,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (verified) {\n\t\t\t\t\t\t\t\t\tvalidatedUserId = verified.sub;\n\t\t\t\t\t\t\t\t\tvalidatedClientId = verified.aud\n\t\t\t\t\t\t\t\t\t\t? typeof verified.aud === \"string\"\n\t\t\t\t\t\t\t\t\t\t\t? verified.aud\n\t\t\t\t\t\t\t\t\t\t\t: verified.aud[0]!\n\t\t\t\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// For HS256 tokens, we need the client_id to verify\n\t\t\t\t\t\t\t\tif (client_id) {\n\t\t\t\t\t\t\t\t\tconst client = await getClient(client_id, trustedClients);\n\t\t\t\t\t\t\t\t\tif (client && client.clientSecret) {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tconst { payload } = await jwtVerify(\n\t\t\t\t\t\t\t\t\t\t\t\tid_token_hint,\n\t\t\t\t\t\t\t\t\t\t\t\tnew TextEncoder().encode(client.clientSecret),\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tvalidatedUserId = payload.sub as string;\n\t\t\t\t\t\t\t\t\t\t\tvalidatedClientId = payload.aud as string;\n\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t// Invalid token, continue with logout but no validation\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t// Invalid id_token_hint, but we continue with logout anyway\n\t\t\t\t\t\t\tctx.context.logger.debug(\n\t\t\t\t\t\t\t\t\"Invalid id_token_hint provided to end_session endpoint\",\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate client_id if provided\n\t\t\t\t\tif (client_id) {\n\t\t\t\t\t\tconst client = await getClient(client_id, trustedClients);\n\t\t\t\t\t\tif (!client) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\terror_description: \"Invalid client_id\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If we have a validated client from the token, ensure they match\n\t\t\t\t\t\tif (validatedClientId && validatedClientId !== client_id) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"client_id does not match the ID Token's audience\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalidatedClientId = client_id;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate post_logout_redirect_uri if provided\n\t\t\t\t\tif (post_logout_redirect_uri) {\n\t\t\t\t\t\tif (!validatedClientId) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"client_id is required when using post_logout_redirect_uri without a valid id_token_hint\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst client = await getClient(validatedClientId, trustedClients);\n\t\t\t\t\t\tif (!client) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\terror_description: \"Invalid client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst isValidRedirectUri = client.redirectUrls.some(\n\t\t\t\t\t\t\t(registeredUri) => post_logout_redirect_uri === registeredUri,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (!isValidRedirectUri) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"post_logout_redirect_uri is not registered for this client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\n\t\t\t\t\tif (validatedUserId || session) {\n\t\t\t\t\t\tconst userId = validatedUserId || session?.user.id;\n\t\t\t\t\t\tif (userId) {\n\t\t\t\t\t\t\tawait ctx.context.adapter.deleteMany({\n\t\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\t\twhere: [{ field: \"userId\", value: userId }],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (session) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(\n\t\t\t\t\t\t\tsession.session.token,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tctx.setSignedCookie(\n\t\t\t\t\t\t\tctx.context.authCookies.sessionToken.name,\n\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmaxAge: 0,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (post_logout_redirect_uri) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst redirectUrl = new URL(post_logout_redirect_uri);\n\t\t\t\t\t\t\tif (state) {\n\t\t\t\t\t\t\t\tredirectUrl.searchParams.set(\"state\", state);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn ctx.redirect(redirectUrl.toString());\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t\terror_description: \"Invalid post_logout_redirect_uri format\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\tmessage: \"Logout successful\",\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\tget options() {\n\t\t\treturn opts;\n\t\t},\n\t} satisfies BetterAuthPlugin;\n};\nexport type * from \"./types\";\n"],"names":["consentCode: string | null","accessToken","idToken: string","client: Client","validatedClientId: string | null","validatedUserId: string | null"],"mappings":"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"}}]
}